<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Exchange</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        .stat-card { cursor: pointer; transition: transform 0.2s, background 0.2s; }
        .stat-card:hover { transform: translateY(-5px); background: rgba(255,255,255,0.1) !important; }
        .error-message { color: #ff7675; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 5px; margin-bottom: 10px; display: none; }
    </style>
</head>
<body>

    <nav class="glass-nav">
        <div class="logo">üéì Academic Exchange</div>
        <div class="search-bar" style="display: flex; gap: 10px; align-items: center; background: rgba(255,255,255,0.1); padding: 5px 15px; border-radius: 25px;">
            <input type="text" id="searchInput" placeholder="Search items..." style="border: none; background: transparent; color: white; flex: 1; outline: none;">
            <div style="position: relative; width: 160px; border-left: 1px solid rgba(255,255,255,0.3); padding-left: 10px;">
                <input type="text" id="locationFilter" placeholder="City/College" style="width: 100%; border: none; background: transparent; color: white; outline: none; font-size: 0.9rem; padding-right: 25px;">
                <button onclick="detectUserLocation()" title="Detect Location" style="position: absolute; right: 0; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 1.2rem; padding: 0;">üìç</button>
            </div>
        </div>
        <div class="nav-links" id="navLinks">
            <button onclick="openModal('loginModal')" class="btn-primary">Login / Register</button>
        </div>
    </nav>

    <main>
        <div class="hero">
            <h1>Student-to-Student Marketplace</h1>
            <p>Buy, sell, and trade academic resources near you.</p>
        </div>
        <div class="filters" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 20px;">
            <button class="filter-btn active" onclick="filterCategory('all')">All</button>
            <button class="filter-btn" onclick="filterCategory('Engineering')">Engineering</button>
            <button class="filter-btn" onclick="filterCategory('MBBS')">MBBS</button>
            <button class="filter-btn" onclick="filterCategory('Law')">Law</button>
            <button class="filter-btn" onclick="filterCategory('Intermediate')">Inter</button>
            <button class="filter-btn" onclick="filterCategory('EAMCET')">EAMCET</button>
            <button class="filter-btn" onclick="filterCategory('GATE')">GATE</button>
            <button class="filter-btn" onclick="filterCategory('PG')">PG</button>
            <button class="filter-btn" onclick="filterCategory('Competitive Exams')">Govt Exams</button>
            <button class="filter-btn" onclick="filterCategory('Gadgets')">Gadgets</button>
            <select id="sortSelect" onchange="handleSort()" style="padding: 8px; border-radius: 15px; border: none; cursor: pointer;">
                <option value="newest">Newest First</option>
                <option value="price_low">Price: Low to High</option>
                <option value="popular">Most Popular</option>
            </select>
        </div>
        <div id="listingsGrid" class="grid-container">
            <p style="color: white; text-align: center; grid-column: span 3;">Loading listings...</p>
        </div>
    </main>

    <div id="sellModal" class="modal">
        <div class="modal-content glass-card">
            <span class="close" onclick="closeModal('sellModal')">&times;</span>
            <h2>Sell an Item</h2>
            <div id="sellError" class="error-message"></div>
            <form id="sellForm">
                <input type="text" id="itemTitle" placeholder="Title" required>
                <textarea id="itemDesc" placeholder="Description..." rows="3" style="width: 90%; margin: 10px 0; padding: 10px; border-radius: 5px;"></textarea>
                <div style="display:flex; gap:10px;">
                    <input type="number" id="itemPrice" placeholder="Price (‚Çπ)" required style="flex:1;">
                    <input type="text" id="itemLocation" placeholder="üìç College / City" required style="flex:1;">
                </div>
                <p style="text-align:left; margin-bottom:5px; font-size:0.9rem;">Category:</p>
                <select id="itemCategory" onchange="updateSubCategories()" style="width: 100%; padding: 10px; margin-bottom: 10px;">
                    <option value="Engineering">Engineering</option>
                    <option value="MBBS">MBBS</option>
                    <option value="Law">Law</option>
                    <option value="Intermediate">Intermediate</option>
                    <option value="EAMCET">EAMCET</option>
                    <option value="GATE">GATE</option>
                    <option value="PG">PG</option>
                    <option value="Competitive Exams">Competitive Exams</option>
                    <option value="Gadgets">Gadgets</option>
                    <option value="Other">Other</option>
                </select>
                <div id="subCatWrapper">
                    <p style="text-align:left; margin-bottom:5px; font-size:0.9rem;">Sub-Category:</p>
                    <select id="itemSubCategory" style="width: 100%; padding: 10px; margin-bottom: 10px;"></select>
                </div>
                <select id="itemCondition" style="width: 100%; padding: 10px; margin-bottom: 10px;">
                    <option value="New">New</option>
                    <option value="Used">Used</option>
                </select>
                <div id="imageUploadSection">
                    <p style="text-align: left; margin-top: 10px;">Upload Images:</p>
                    <input type="file" id="itemImages" multiple accept="image/*">
                </div>
                <button type="submit" class="btn-primary" style="margin-top: 15px;">Post Listing</button>
            </form>
        </div>
    </div>

    <div id="loginModal" class="modal">
        <div class="modal-content glass-card">
            <span class="close" onclick="closeModal('loginModal')">&times;</span>
            <h2>Welcome Back</h2>
            <div id="authError" class="error-message"></div>
            <form id="loginForm">
                <input type="email" id="email" placeholder="Email" required>
                <input type="password" id="password" placeholder="Password" required>
                <button type="submit" class="btn-primary">Login</button>
            </form>
            <p>No account? <a href="#" id="toggleRegister">Register</a></p>
        </div>
    </div>

    <div id="chatModal" class="modal">
        <div class="modal-content glass-card" style="height: 500px; display: flex; flex-direction: column;">
            <span class="close" onclick="closeModal('chatModal')">&times;</span>
            <h2 id="chatTitle">Chat with Seller</h2>
            <div id="chatWindow" style="flex: 1; overflow-y: auto; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 10px; margin-bottom: 10px; text-align: left;"></div>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="messageInput" placeholder="Type a message..." style="flex: 1;">
                <button onclick="sendMessage()" class="btn-primary">Send</button>
            </div>
        </div>
    </div>

    <div id="profileModal" class="modal">
        <div class="modal-content glass-card" style="max-width: 600px;">
            <span class="close" onclick="closeModal('profileModal')">&times;</span>
            <h2>My Profile</h2>
            <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                <div style="position: relative;">
                    <img id="profileAvatar" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI2ZmZiIgd2lkdGg9IjEwMHB4IiBoZWlnaHQ9IjEwMHB4Ij48cGF0aCBkPSZNMTIgMTJjMi4yMSAwIDQtMS43OSA0LTRzLTEuNzktNC00LTQtNCAxLjc5LTQgNCAxLjc5IDQgNCA0em0wIDJjLTIuNjcgMC04IDEuMzQtOCA0djJoMTZ2LTJjMC0yLjY2LTUuMzMtNC04LTR6Ii8+PC9zdmc+" 
                         style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 2px solid #6c5ce7; background:#ccc;">
                    <button onclick="document.getElementById('avatarInput').click()" style="position: absolute; bottom: 0; right: 0; background: #6c5ce7; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; color: white;">+</button>
                    <input type="file" id="avatarInput" hidden accept="image/*" onchange="uploadAvatar()">
                </div>
                <div style="text-align: left; flex: 1;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <h3 id="profileName" style="margin: 0;">Student Name</h3>
                        <button onclick="editProfileDetails()" title="Edit Name" style="background: none; border: none; color: #00b894; cursor: pointer; font-size: 1.2rem;">‚úé</button>
                    </div>
                    <p id="profileEmail" style="opacity: 0.7; font-size: 0.9rem; margin-top: 5px;">email@test.com</p>
                </div>
            </div>
            <button onclick="openSellModal()" class="btn-primary" style="width: 100%; background: #00b894; margin-bottom: 20px; padding: 12px; font-weight: bold;">+ Sell New Item</button>
            <h3 style="text-align: left; margin-bottom: 10px;">My Listings</h3>
            <div id="myListingsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; max-height: 300px; overflow-y: auto;"></div>
        </div>
    </div>

    <div id="detailsModal" class="modal">
        <div class="modal-content glass-card" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
            <span class="close" onclick="closeModal('detailsModal')">&times;</span>
            <div style="display:flex; flex-wrap:wrap; gap:20px; margin-bottom: 30px;">
                <div style="flex: 1; min-width: 300px;">
                    <img id="detailImage" src="" style="width: 100%; border-radius: 10px; object-fit: cover; aspect-ratio: 4/3; margin-bottom: 10px;">
                    <div id="detailThumbnails" style="display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px;"></div>
                </div>
                <div style="flex: 1; min-width: 300px; text-align: left;">
                    <h2 id="detailTitle" style="font-size: 2rem; margin-bottom: 10px;">Title</h2>
                    <h3 id="detailPrice" style="color: #00b894; font-size: 1.5rem;">‚Çπ0.00</h3>
                    <div style="margin: 15px 0; font-size: 0.9rem; opacity: 0.8;">
                        <span id="detailCategory" style="background: rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 15px;">Category</span>
                        <span id="detailSub" style="background: rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 15px; margin-left: 5px;">Sub</span>
                        <span id="detailLoc" style="background: #e17055; padding: 5px 10px; border-radius: 15px; margin-left: 5px;">üìç Location</span>
                    </div>
                    <p id="detailDesc" style="line-height: 1.6; margin-bottom: 20px; white-space: pre-wrap;">Description...</p>
                    <div style="display: flex; gap: 10px;">
                        <button id="detailChatBtn" class="btn-primary" style="flex: 1;">Chat with Seller</button>
                        <button id="detailWishlistBtn" class="btn-primary" style="background: #ff7675; width: 50px;">‚ô•</button>
                    </div>
                </div>
            </div>
            <h3 style="text-align: left; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px;">Similar Items</h3>
            <div id="relatedGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;"></div>
        </div>
    </div>

    <div id="adminModal" class="modal">
        <div class="modal-content glass-card" style="max-width: 800px;">
            <span class="close" onclick="closeModal('adminModal')">&times;</span>
            <h2>Admin Dashboard</h2>
            <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                <div class="stat-card" onclick="adminShow('users')" style="flex:1; background:rgba(0,0,0,0.3); padding:20px; border-radius:10px; text-align:center;">
                    <h3 id="statUsers">0</h3><p>Total Users</p>
                </div>
                <div class="stat-card" onclick="adminShow('listings')" style="flex:1; background:rgba(0,0,0,0.3); padding:20px; border-radius:10px; text-align:center;">
                    <h3 id="statListings">0</h3><p>Active Listings</p>
                </div>
                <div class="stat-card" onclick="adminShow('sold')" style="flex:1; background:rgba(0,0,0,0.3); padding:20px; border-radius:10px; text-align:center;">
                    <h3 id="statSold">0</h3><p>Items Sold</p>
                </div>
            </div>
            <h3 id="adminSectionTitle">User Management</h3>
            <div id="adminDynamicContent" style="max-height: 300px; overflow-y: auto; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 10px;"></div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="js/main.js"></script>

</body>
</html>

