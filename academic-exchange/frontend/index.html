<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#0f0c29">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Academic Exchange â€” Student Marketplace</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>

<!-- â”€â”€ ANIMATED BG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="bg-orbs">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>
    <div class="orb orb-4"></div>
</div>
<canvas id="particleCanvas"></canvas>

<!-- â”€â”€ NAVBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<nav class="navbar">
    <div class="logo" onclick="scrollTo(0,0)">
        <span class="logo-icon">ğŸ“</span>
        Academic Exchange
    </div>
    <div class="nav-menu" id="navMenu">
        <button class="nav-btn" onclick="showLogin()">Login</button>
        <button class="nav-btn primary" onclick="showRegister()">Sign Up</button>
    </div>
</nav>

<!-- â”€â”€ HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<section class="hero">
    <!-- Floating background emojis -->
    <div class="hero-floaters">
        <span class="floater">ğŸ“š</span>
        <span class="floater">ğŸ”¬</span>
        <span class="floater">ğŸ’¡</span>
        <span class="floater">ğŸ§ª</span>
        <span class="floater">ğŸ“</span>
        <span class="floater">ğŸ¯</span>
        <span class="floater">âœï¸</span>
        <span class="floater">ğŸ–¥ï¸</span>
        <span class="floater">ğŸ““</span>
        <span class="floater">ğŸ†</span>
    </div>

    <div class="hero-badge">
        <span class="hero-badge-dot"></span>
        India's #1 Student Marketplace â€” Free to Use
    </div>

    <h1>Studentâ€‘toâ€‘Student<br>Marketplace</h1>

    <p class="hero-subtitle">
        Buy, sell &amp; trade books, notes, gadgets and more<br>
        with students at your college and nearby
    </p>

    <div class="hero-stats">
        <div class="stat-item">
            <div class="stat-num" id="statListings">â€”</div>
            <div class="stat-label">Listings</div>
        </div>
        <div class="stat-item">
            <div class="stat-num">100%</div>
            <div class="stat-label">Free</div>
        </div>
        <div class="stat-item">
            <div class="stat-num">âš¡</div>
            <div class="stat-label">Realâ€‘time Chat</div>
        </div>
        <div class="stat-item">
            <div class="stat-num">ğŸ“</div>
            <div class="stat-label">Near You</div>
        </div>
    </div>

    <div class="search-container">
        <div class="search-wrapper">
            <span class="search-icon">ğŸ”</span>
            <input type="text" class="search-input" id="searchInput"
                   placeholder="Search books, notes, gadgets, lab kitsâ€¦"
                   autocomplete="off">
        </div>
        <button class="location-btn" onclick="openMapFilter()">ğŸ“ Near Me</button>
    </div>

    <div id="locationFilterBadge" class="location-badge hidden">
        <span>ğŸ“</span>
        <span id="locationFilterText">Filtering by location</span>
        <button onclick="clearLocationFilter()">âœ•</button>
    </div>
</section>

<!-- â”€â”€ STICKY FILTER BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="filters-wrapper">
    <div class="filters">
        <div class="filter-row">
            <span class="filter-label">Category</span>
            <button class="filter-btn active" onclick="filterCategory('all',this)">All</button>
            <button class="filter-btn" onclick="filterCategory('Engineering',this)">âš™ï¸ Engineering</button>
            <button class="filter-btn" onclick="filterCategory('MBBS',this)">ğŸ©º MBBS</button>
            <button class="filter-btn" onclick="filterCategory('Law',this)">âš–ï¸ Law</button>
            <button class="filter-btn" onclick="filterCategory('Gadgets',this)">ğŸ–¥ï¸ Gadgets</button>
        </div>
        <div class="filter-row">
            <span class="filter-label">Condition</span>
            <button class="filter-btn condition-btn active" onclick="filterCondition('all',this)">All</button>
            <button class="filter-btn condition-btn" onclick="filterCondition('New',this)">âœ¨ New</button>
            <button class="filter-btn condition-btn" onclick="filterCondition('Used',this)">â™»ï¸ Used</button>
            <select class="sort-select" id="sortSelect" onchange="applyFilters()">
                <option value="">â†• Latest</option>
                <option value="price_low">â†‘ Price Low</option>
                <option value="price_high">â†“ Price High</option>
                <option value="popular">ğŸ”¥ Popular</option>
            </select>
        </div>
    </div>
</div>

<!-- â”€â”€ SECTION HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="section-header">
    <span class="section-title">âœ¨ Latest Listings</span>
    <span class="section-count" id="listingCount"></span>
</div>

<!-- â”€â”€ LISTINGS GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="listings-grid" id="listingsGrid">
    <div class="loading-state">
        <div class="loading-spinner"></div>
        <p>Loading listingsâ€¦</p>
    </div>
</div>

<!-- â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<footer class="footer">
    Made with â¤ï¸ for students Â· <strong>Academic Exchange</strong> Â· Â© 2025
</footer>

<!-- â”€â”€ SCROLL TO TOP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<button class="scroll-top" id="scrollTopBtn" onclick="scrollTo({top:0,behavior:'smooth'})">â–²</button>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PROFILE DROPDOWN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="profile-dropdown" id="profileDropdown">
    <button class="dropdown-item" onclick="closeDropdown();showSellModal()">
        <span class="di-icon">ğŸ›’</span> Sell Item
    </button>
    <button class="dropdown-item" onclick="closeDropdown();showMyItems()">
        <span class="di-icon">ğŸ“¦</span> My Items
    </button>
    <button class="dropdown-item" onclick="closeDropdown();showChats()">
        <span class="di-icon">ğŸ’¬</span> Chats
    </button>
    <button class="dropdown-item" onclick="closeDropdown();showChangePassword()">
        <span class="di-icon">ğŸ”’</span> Change Password
    </button>
    <hr class="dropdown-divider">
    <button class="dropdown-item danger" onclick="logout()">
        <span class="di-icon">ğŸšª</span> Logout
    </button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MODALS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<!-- LOGIN -->
<div class="modal" id="loginModal">
    <div class="modal-content">
        <button class="modal-close" onclick="closeModal('loginModal')">âœ•</button>
        <div class="modal-header-icon">ğŸ‘‹</div>
        <h2>Welcome Back!</h2>
        <form id="loginForm" onsubmit="handleLogin(event)">
            <input type="email"    class="form-input" placeholder="Email address"  required id="loginEmail">
            <input type="password" class="form-input" placeholder="Password"       required id="loginPassword">
            <button type="submit" class="btn btn-primary" style="width:100%">Login â†’</button>
        </form>
        <p style="margin-top:1rem;text-align:center;font-size:.88rem;color:var(--text-muted)">
            No account? <a href="#" onclick="showRegister()" style="color:#c4b5fd;font-weight:600">Sign up free</a>
        </p>
    </div>
</div>

<!-- REGISTER -->
<div class="modal" id="registerModal">
    <div class="modal-content">
        <button class="modal-close" onclick="closeModal('registerModal')">âœ•</button>
        <div class="modal-header-icon">ğŸš€</div>
        <h2>Create Account</h2>
        <form id="registerForm" onsubmit="handleRegister(event)">
            <input type="text"     class="form-input" placeholder="Full Name"      required id="registerName">
            <input type="email"    class="form-input" placeholder="Email address"  required id="registerEmail">
            <input type="password" class="form-input" placeholder="Password (min 6 chars)" required id="registerPassword">
            <button type="submit" class="btn btn-primary" style="width:100%">Create Account ğŸ‰</button>
        </form>
        <p style="margin-top:1rem;text-align:center;font-size:.88rem;color:var(--text-muted)">
            Already have an account? <a href="#" onclick="showLogin()" style="color:#c4b5fd;font-weight:600">Login</a>
        </p>
    </div>
</div>

<!-- SELL -->
<div class="modal" id="sellModal">
    <div class="modal-content">
        <button class="modal-close" onclick="closeModal('sellModal')">âœ•</button>
        <div class="modal-header-icon">ğŸ›’</div>
        <h2>Post a Listing</h2>
        <form id="sellForm" onsubmit="handleSell(event)">
            <input type="text"   class="form-input"    placeholder="Item title"            required id="sellTitle">
            <textarea            class="form-textarea"  placeholder="Description (condition, edition, etc.)" required id="sellDesc" rows="3"></textarea>
            <input type="number" class="form-input"    placeholder="Price (â‚¹)"             required id="sellPrice" min="0">
            <select              class="form-select"                                        required id="sellCategory">
                <option value="">Select Category</option>
                <option value="Engineering">âš™ï¸ Engineering</option>
                <option value="MBBS">ğŸ©º MBBS</option>
                <option value="Law">âš–ï¸ Law</option>
                <option value="Gadgets">ğŸ–¥ï¸ Gadgets</option>
            </select>
            <select class="form-select" id="sellCondition" required>
                <option value="New">âœ¨ New</option>
                <option value="Used">â™»ï¸ Used</option>
            </select>
            <div class="location-pick-group">
                <input type="text" class="form-input" placeholder="Location (e.g. Hyderabad)" id="sellLocation">
                <button type="button" class="btn-pick-location" onclick="openSellLocationPicker()">ğŸ“ Pick on Map</button>
                <span id="sellLocationCoords" class="coords-display"></span>
            </div>
            <input type="file" class="form-input" id="sellImages" accept="image/*" multiple required>
            <button type="submit" class="btn btn-primary" style="width:100%;margin-top:.5rem">Post Listing ğŸ“¤</button>
        </form>
    </div>
</div>

<!-- LISTING DETAIL -->
<div class="modal" id="listingModal">
    <div class="modal-content modal-wide">
        <button class="modal-close" onclick="closeModal('listingModal')">âœ•</button>
        <div id="listingDetail"></div>
    </div>
</div>

<!-- MY ITEMS -->
<div class="modal" id="myItemsModal">
    <div class="modal-content modal-wide">
        <button class="modal-close" onclick="closeModal('myItemsModal')">âœ•</button>
        <div class="modal-header-icon">ğŸ“¦</div>
        <h2>My Items</h2>
        <div id="myItemsContent" class="my-items-grid">
            <div class="loading-state"><div class="loading-spinner"></div><p>Loadingâ€¦</p></div>
        </div>
    </div>
</div>

<!-- CHATS -->
<div class="modal" id="chatsModal">
    <div class="modal-content modal-wide chat-layout">
        <button class="modal-close" onclick="closeModal('chatsModal')">âœ•</button>
        <h2>ğŸ’¬ Chats</h2>
        <div class="chat-container">
            <div class="chat-list" id="chatList">
                <div class="loading-state"><div class="loading-spinner"></div></div>
            </div>
            <div class="chat-window" id="chatWindow">
                <div class="chat-placeholder">
                    <span class="chat-placeholder-icon">ğŸ’¬</span>
                    Select a conversation
                </div>
            </div>
        </div>
    </div>
</div>

<!-- CHANGE PASSWORD -->
<div class="modal" id="changePasswordModal">
    <div class="modal-content">
        <button class="modal-close" onclick="closeModal('changePasswordModal')">âœ•</button>
        <div class="modal-header-icon">ğŸ”’</div>
        <h2>Change Password</h2>
        <form id="changePasswordForm" onsubmit="handleChangePassword(event)">
            <input type="password" class="form-input" placeholder="Current Password"      required id="currentPassword">
            <input type="password" class="form-input" placeholder="New Password"          required id="newPassword">
            <input type="password" class="form-input" placeholder="Confirm New Password"  required id="confirmPassword">
            <button type="submit" class="btn btn-primary" style="width:100%">Update Password</button>
        </form>
        <div id="changePasswordMsg" class="form-message"></div>
    </div>
</div>

<!-- MAP FILTER -->
<div class="modal" id="mapFilterModal">
    <div class="modal-content modal-wide">
        <button class="modal-close" onclick="closeModal('mapFilterModal')">âœ•</button>
        <div class="modal-header-icon">ğŸ“</div>
        <h2>Filter by Location</h2>
        <p class="map-hint">Click anywhere on the map to set your location, then drag the radius slider.</p>
        <div id="mapContainer" style="height:340px;border-radius:16px;overflow:hidden;margin:1rem 0;border:1px solid var(--border)"></div>
        <div class="range-control">
            <label>Search Radius: <strong id="radiusValue">10 km</strong></label>
            <input type="range" id="radiusSlider" min="1" max="100" value="10" oninput="updateRadius(this.value)">
        </div>
        <div id="mapLocationText" class="map-location-text">No location selected â€” click the map above</div>
        <div style="display:flex;gap:.75rem;margin-top:1rem">
            <button class="btn btn-secondary" style="flex:1" onclick="useMyLocation()">ğŸ“¡ Use My Location</button>
            <button class="btn btn-primary"   style="flex:1" onclick="applyLocationFilter()">Apply Filter âœ“</button>
        </div>
    </div>
</div>

<!-- SELL LOCATION PICKER -->
<div class="modal" id="sellMapModal">
    <div class="modal-content modal-wide">
        <button class="modal-close" onclick="closeModal('sellMapModal')">âœ•</button>
        <div class="modal-header-icon">ğŸ“Œ</div>
        <h2>Pick Item Location</h2>
        <p class="map-hint">Click on the map to mark where this item is located.</p>
        <div id="sellMapContainer" style="height:340px;border-radius:16px;overflow:hidden;margin:1rem 0;border:1px solid var(--border)"></div>
        <div id="sellMapLocationText" class="map-location-text">No location selected â€” click the map</div>
        <button class="btn btn-primary" style="width:100%;margin-top:1rem" onclick="confirmSellLocation()">Confirm Location ğŸ“Œ</button>
    </div>
</div>

<!-- â”€â”€ SCRIPTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
<script src="js/main.js"></script>
<script>
// â”€â”€ PARTICLE SYSTEM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function() {
    const canvas = document.getElementById('particleCanvas');
    const ctx = canvas.getContext('2d');
    let W, H, particles = [];

    function resize() {
        W = canvas.width  = window.innerWidth;
        H = canvas.height = window.innerHeight;
    }
    resize();
    window.addEventListener('resize', resize);

    function Particle() {
        this.reset();
    }
    Particle.prototype.reset = function() {
        this.x = Math.random() * W;
        this.y = Math.random() * H;
        this.r = Math.random() * 1.5 + 0.3;
        this.vx = (Math.random() - 0.5) * 0.4;
        this.vy = (Math.random() - 0.5) * 0.4;
        this.alpha = Math.random() * 0.5 + 0.1;
        const hues = [260, 190, 310, 40];
        this.hue = hues[Math.floor(Math.random() * hues.length)];
    };
    Particle.prototype.update = function() {
        this.x += this.vx; this.y += this.vy;
        if (this.x < 0 || this.x > W || this.y < 0 || this.y > H) this.reset();
    };
    Particle.prototype.draw = function() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
        ctx.fillStyle = `hsla(${this.hue},80%,70%,${this.alpha})`;
        ctx.fill();
    };

    for (let i = 0; i < 120; i++) particles.push(new Particle());

    // draw connections
    function drawConnections() {
        for (let i = 0; i < particles.length; i++) {
            for (let j = i + 1; j < particles.length; j++) {
                const dx = particles[i].x - particles[j].x;
                const dy = particles[i].y - particles[j].y;
                const dist = Math.sqrt(dx*dx + dy*dy);
                if (dist < 100) {
                    ctx.beginPath();
                    ctx.moveTo(particles[i].x, particles[i].y);
                    ctx.lineTo(particles[j].x, particles[j].y);
                    ctx.strokeStyle = `rgba(167,139,250,${0.08 * (1 - dist/100)})`;
                    ctx.lineWidth = 0.5;
                    ctx.stroke();
                }
            }
        }
    }

    function loop() {
        ctx.clearRect(0, 0, W, H);
        drawConnections();
        particles.forEach(p => { p.update(); p.draw(); });
        requestAnimationFrame(loop);
    }
    loop();
})();

// â”€â”€ SCROLL-TO-TOP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('scroll', function() {
    const btn = document.getElementById('scrollTopBtn');
    if (window.scrollY > 400) btn.classList.add('visible');
    else btn.classList.remove('visible');
});

// â”€â”€ STAGGER CARD ENTRANCE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const cardObserver = new IntersectionObserver((entries) => {
    entries.forEach((entry, i) => {
        if (entry.isIntersecting) {
            entry.target.style.animationDelay = (i * 0.06) + 's';
            entry.target.classList.add('visible');
            cardObserver.unobserve(entry.target);
        }
    });
}, { threshold: 0.1 });

// observe new cards whenever grid updates
const gridObserver = new MutationObserver(() => {
    document.querySelectorAll('.card:not(.visible)').forEach(card => {
        cardObserver.observe(card);
    });
});
gridObserver.observe(document.getElementById('listingsGrid'), { childList: true });
</script>
</body>
</html>
